<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ä¹¦ç±æ•°æ®å›¾è¡¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f8fb;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .container {
            padding: 20px;
        }

        .chart-container {
            margin-bottom: 40px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        canvas {
            width: 100% !important;
            max-width: 800px;
            margin: auto;
        }

        footer {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
        }

        .home-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .home-link:hover {
            background-color: #388e3c;
        }
    </style>
</head>

<body>

    <header>
        <h1>ğŸ“Š ä¹¦ç±æ•°æ®åˆ†æå›¾è¡¨</h1>
    </header>

    <div class="container">
        <a href="index.html" class="home-link">è¿”å›ä¸»é¡µ</a>

        <div class="chart-container">
            <h3>è¯„åˆ†åˆ†å¸ƒ</h3>
            <canvas id="ratingChart"></canvas>
        </div>

        <div class="chart-container">
            <h3>ä»·æ ¼åˆ†å¸ƒ</h3>
            <canvas id="priceChart"></canvas>
        </div>

        <div class="chart-container">
            <h3>è¯„åˆ†äººæ•°åˆ†å¸ƒ</h3>
            <canvas id="numRatingsChart"></canvas>
        </div>
    </div>

    <footer>
        <p>Â© 2025 å›¾ä¹¦æ•°æ®å±•ç¤ºå¹³å°</p>
    </footer>

    <script>
        fetch('books_data.json')
            .then(res => res.json())
            .then(data => {
                // æ•°æ®æ¸…æ´—
                const ratings = data.map(d => parseFloat(d.rating)).filter(n => !isNaN(n));
                const prices = data.map(d => parseFloat(d.price)).filter(n => !isNaN(n));
                const numRatings = data.map(d => parseInt(d.numRatings)).filter(n => !isNaN(n));

                // æ„å»ºç›´æ–¹å›¾å‡½æ•°
                function createHistogram(ctx, dataArray, label, color) {
                    const bins = 20;
                    const max = Math.max(...dataArray);
                    const min = Math.min(...dataArray);
                    const binSize = (max - min) / bins;

                    const labels = [];
                    const counts = new Array(bins).fill(0);

                    dataArray.forEach(value => {
                        const index = Math.min(Math.floor((value - min) / binSize), bins - 1);
                        counts[index]++;
                    });

                    for (let i = 0; i < bins; i++) {
                        const rangeStart = (min + i * binSize).toFixed(1);
                        const rangeEnd = (min + (i + 1) * binSize).toFixed(1);
                        labels.push(`${rangeStart}~${rangeEnd}`);
                    }

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: label,
                                data: counts,
                                backgroundColor: color
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    ticks: {
                                        maxRotation: 60,
                                        minRotation: 45
                                    }
                                },
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                // åˆ›å»ºä¸‰ä¸ªå›¾è¡¨
                createHistogram(document.getElementById('ratingChart'), ratings, 'è¯„åˆ†åˆ†å¸ƒ', '#42a5f5');
                createHistogram(document.getElementById('priceChart'), prices, 'ä»·æ ¼åˆ†å¸ƒ', '#66bb6a');
                createHistogram(document.getElementById('numRatingsChart'), numRatings, 'è¯„åˆ†äººæ•°åˆ†å¸ƒ', '#ffa726');
            })
            .catch(error => console.error("åŠ è½½æ•°æ®å¤±è´¥:", error));
    </script>

</body>

</html>